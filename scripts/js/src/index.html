<!DOCTYPE html >
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title> Genesis: Software Analytics Visualization Tool </title>

    <script type="text/javascript" src="../lib/mbostock/d3.js"></script>
    <script type="text/javascript" src="../lib/mbostock/d3.time.js"></script>
	<script type="text/javascript" src="../lib/mbostock/d3.layout.js"></script>
	<script type="text/javascript" src="../lib/mbostock/lib/jquery/jquery.js"></script>
	<script type="text/javascript" src="../lib/mbostock/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="../lib/mbostock/d3.geom.js"></script>
	<script type="text/javascript" src="deepCopy.js"></script>

	<script type="text/javascript" src="argouml/rev_4600_inheritance.js"></script>
	<script type="text/javascript" src="argouml/rev_4600_invocations.js"></script>
	<script type="text/javascript" src="ModelGraph.js"></script>
	<script type="text/javascript" src="Trees.js"></script>
	<script type="text/javascript" src="Sunbursts.js"></script>
	<script type="text/javascript" src="Graph.js"></script>
		<script type="text/javascript" src="tooltip.js"></script>
	<script type="text/javascript" src="GraphToD3Graph.js"></script>
	<script type="text/javascript" src="authors/authors.js"></script>

	<script type="text/javascript" src="authors/AuthorAnalysis.js"></script>


	<script type="text/javascript" src="edge_data.js"></script>
	<script type="text/javascript" src="node_data.js"></script>
	<script type="text/javascript" src="displayInfo.js"></script>
	<script type="text/javascript" src="force.js"></script>
	<script type="text/javascript" src="VisualizationRegister.js"></script>
	<script type="text/javascript" src="Visualization.js"></script>
	<script type="text/javascript" src="TimeLine.js"> </script>
	<script type="text/javascript" src="options/SizeFunction.js"></script>
    <script type="text/javascript" src="options/ColorFunction.js"></script>
	<script type="text/javascript" src="options/StrokeFunction.js"></script>
	<script type="text/javascript" src="AnalysisUtils.js"> </script>
	<script type="text/javascript" src="Analysis.js"> </script>
	<script type="text/javascript" src="cleanHistory.js"></script>
	<script type="text/javascript" src="calendar/history.js"></script>
	<script type="text/javascript" src="calendar/calendar.js"></script>
	<script type="text/javascript" src="QueryLanguage.js"></script>

	<link type="text/css" rel="stylesheet" href="../../../website/pages/style/tooltip.css"/>	
	<link type="text/css" rel="stylesheet" href="calendar/calendar.css"/>

	<script type="text/javascript">

	var subclasses = "superclassOf"; var classType = "Class";
	var methods = "methods"; 
	var classes = "classes";
	var attributes = "attributes";
	var namespaces = "namespaces"; packageType = "Namespace";

	function visualizeOptions (analysis,visualization) {
		var div = document.getElementById("optionsDiv");
		
		// Get all the options
		var opts = getOptions(analysis,visualization);
		
		// Set Unary Ones and get remaining
		opts = setUnaryOptionsAndGet(visualization,opts);
		
		var html = "<ul>";
		for (var el in opts) {
	   		html += "<li>" + el + "<ul>";
			
			for (var opt in opts[el]) {
				html +=  "<li>" + opt + "</li><ul>";
				for (var i = 0; i < opts[el][opt].length;++i) {
					var innerOpt = opts[el][opt][i];
					html += "<li>" + innerOpt.name + "</li>";
				}
				html += "</ul>";
			}
			html += "</ul></li>"
		}			
		html += "</ul>";
		div.innerHTML = html;
	}
	
	function testDensity () {
		var listOfAnalysis = analysisRegister.getEntries(["Revision"]);
		var analysis = listOfAnalysis[2];
		
		
		var vis = analysis.instantiateVisualization(0);
		
		vis.initialize(cleanHistory(owl.deepCopy(history)));
		var opts = getOptions(analysis,vis);
		opts = setUnaryOptionsAndGet(vis,opts);
		
		var obj = {
			types: ["Revision"],
			nodes: [vis.source],
		};
		
		vis.visualize(obj,"#chart");
	}
	
	function testCollaboration () {
		var listOfAnalysis = analysisRegister.getEntries(["Revision"]);
		var analysis = listOfAnalysis[1];
		
		
		var vis = analysis.instantiateVisualization(0);
		
		vis.initialize(cleanHistory(owl.deepCopy(history)));
		var opts = getOptions(analysis,vis);
		opts = setUnaryOptionsAndGet(vis,opts);
		
		var obj = {
			types: ["Revision"],
			nodes: [vis.source],
		};
		
		vis.visualize(obj,"#chart");		
	}
	
	function testCalendar () {
		var listOfAnalysis = analysisRegister.getEntries(["Revision"]);
		var analysis = listOfAnalysis[0];
		
		
		var vis = analysis.instantiateVisualization(0);
		
		vis.initialize(cleanHistory(owl.deepCopy(history)));
		var opts = getOptions(analysis,vis);
		opts = setUnaryOptionsAndGet(vis,opts);
		
		var obj = {
			types: ["Revision"],
			nodes: [vis.source],
		};
		
		vis.visualize(obj,"#chart");
	}

	function testRegister() {
		var graph = genesis.Graph.create(node_data.nodes,edge_data.edges);

		var listOfAnalysis = analysisRegister.getEntries(["Class"]);
		var analysis = listOfAnalysis[0];
						
		var vis = analysis.instantiateVisualization(2);
		
		vis.initialize(graph);
		
		visualizeOptions(analysis,vis);
		
		var roots = vis.candidates();

		vis.addElementOption("nodes","sizeFunction",childrenSize(graph));
		vis.addElementOption("nodes","mouseover",{
			evalFun: function (d,i) {
				d3.select("#monitor").html(createInfo(d)) 
			},
			name: "On Click Handler",
		});
		var obj = {
			types: ["Class"],
			nodes:roots,
		}

		vis.visualize(obj,"#chart");
		
		var results = getQueryResults("Method:L*",["Method"],graph);
		alert(results);
	}
		
	
	function getInvocationSelector() {
	 	var relationName = "invokingMethods";
			var nodeType = "Method";	

			var opt = {
				// maxEdges : 200,
				// 		currentEdges: 0,	
				removeUnconnected : true,
				selectRelation : function(rel) { return rel == relationName; },
				selectNode : function(node) {   return node.properties.ElementType == nodeType; },
				selectEdge : function(nodeFrom, nodeTo) { 
					// var ret = (this.currentEdges <= this.maxEdges); 
					// if(ret)  
					// 	this.currentEdges++; 
					// return ret 
					return true;
				}
			};
		return opt;
	}
	


	function plotGraph() {



//		var graph = genesis.Graph.create(node_data.nodes, edge_data.edges);
		//var opt = getInvocationSelector();
		//var selection = graph.getSelection(opt);
//		var nodeName = "Action";
		var nodeName = "JavaParser";
		var relationName = "methods";
		var otherRelationName = "attributes";
		var thirdRelationName = "superclassOf";
		var nodeType = "Class";
				
		// var nodeName = "EventHandler";
		// var relationName = "superclassOf";
		// var nodeType = "Class"
		
		
		//forceDirectedGraph(subGraph.nodes, subGraph.edges);


			var graph = genesis.Graph.create(node_data.nodes,edge_data.edges);

			var listOfAnalysis = analysisRegister.getEntries(["Method", "Class"]);
			var analysis = listOfAnalysis[0];

			var vis = analysis.instantiateVisualization(0);

			vis.initialize(graph);

		vis.elements["nodes"].options.colorFunction.value = typeColor(graph);
		vis.elements["nodes"].options.sizeFunction.value = elementSize(graph);
		vis.addElementOption("nodes","mouseover",{
			evalFun: function (d,i) {
				d3.select("#monitor").html(createInfo(d)) 
			},
			name: "On Click Handler",
		});

		/*vis.options["filter"] = { value: function (graph) {
			var centers = graph.getNodeSelection(function(node) {
				return (node.properties.name == nodeName || node.properties.name == "EventHandler") && node.properties.ElementType == nodeType;
			});


			var opt = {
				center : centers[0],
				oneToOneEdges : true,
				collapse : true,
				selectRelation : function(relName) { return relName == relationName || relName == otherRelationName || relName == thirdRelationName; }
			};

			var selection = graph.getSubgraph(opt);

			var subGraph = toD3Graph(selection.nodes, selection.edges);
			return [subGraph];
		}*/
	
		var opts = getOptions(analysis,vis);
		opts = setUnaryOptionsAndGet(vis,opts);
	
		var centers = graph.getNodeSelection(function(node) {
					return node.properties.ElementType == "Class" && ( node.properties.name == "ActionPrint" )// || node.properties.name == "JavaParser" || node.properties.name == "LanguageParser"  );
				});
		
		var element = {
			types: [ "Method", "Class" ],
			nodes: centers,
		}
		

		vis.visualize(element,"#chart");
	}


	function testMixedGraph() {
			var graph = genesis.Graph.create(node_data.nodes,edge_data.edges);
			var opt = {
				centers :  graph.getNodeSelection(function(node) {  return node.properties.name == "JavaParser"; }), //graph.getNodesByType("Class"),
				
				expand : function(node, relName) { 
					return   this.selectNode(node) && (relName == "methods"  || relName == "invokingMethods");
				},
				
				selectNode : function(node) {
						return node.properties.ElementType == "Class" ||
							   node.properties.ElementType == "Method";
				},
				
				selectEdge : function(node1, node2) {
					return true;
				}
			};
			
			var mixedGraph = graph.getMixedGraph(opt);
			var d3MixedGraph = toD3Graph(mixedGraph.nodes, mixedGraph.edges);
	}

	function getTreeFromRelation(relationName, elementType) {
		var graph = genesis.Graph.create(node_data.nodes, edge_data.edges);
		return toD3Trees(graph, relationName, elementType);
	} 

	</script>

	<link type="text/css" rel="stylesheet" href="scrollbar.css"/>
	<link type="text/css" rel="stylesheet" href="tree.css"/>
</head>
<body onload="">
	<ul class="Menu">
		<!--
		<li><a href="javascript:tree()"> Tree </li>
		<li><a href="javascript:graph()"> Graph </a> </li>
		<li><a href="javascript:hist()"> Histogram </a> </li> -->
		<li><a href="javascript:javascript:testDensity()"> Density Map <a> </li>
		<li><a href="javascript:javascript:testCollaboration()"> Collaboration <a> </li>
		<li><a href="javascript:javascript:testCalendar()"> Calendar <a> </li>
			<li><a href="javascript:javascript:sunburst(getTreeFromRelation(methods, classType));"> Invocations Sunburst <a> </li>
				<li> <a href="javascript:roots(getTreeFromRelation(subclasses, classType));"> Inheritance Tree</a> </li>
				<li> <a href="javascript:testRegister();"> Inheritance Tree With Register</a> </li>
				<li> <a href="javascript:roots(getTreeFromRelation(methods, classType));"> Invocations Tree</a> </li>
				<li> <a href="javascript:roots(getTreeFromRelation(classes, packageType));"> Classes in Packages</a> </li>
				<li> <a href="javascript:roots(getTreeFromRelation(attributes, classType));"> Attributes in Classes</a> </li>
				<li> <a href="javascript: plotGraph()"> CallGraph </a> </li>
			</ul>
			<div id="treename"></div>
			<div id="monitor"></div>
			<div class="Block">
				<div id="chart" class="Block Right" style="overflow:visible"> </div>
				<div id="roots" class="Block Left List"></div>
			</div>
			<div id="optionsDiv"></div>

<!--
<div id="slider_controls"> 
<input id="playbutton" type="image" src="img/play.png" name="image" width="60" height="60" onClick="play()" />
<input id="timewarp" type="range" min="0" max="50" value="0" step="5" onchange="showValue(this.value)" />
</div> -->

</body>
</html>
